# 多模态数据分析师Agent - 使用说明

## 启动和停止服务器

### 启动服务器

```bash
python api_server.py
```

服务器启动后会显示：
```
============================================================
  多模态数据分析师Agent API服务器
============================================================
  服务地址: http://127.0.0.1:8000
  Web界面: http://127.0.0.1:8000/
============================================================
```

### 停止服务器

#### 方法1：使用停止脚本（最简单）⭐

**Windows批处理文件：**
```bash
stop_server.bat
```

**Python脚本（跨平台）：**
```bash
python stop_server.py
```

**指定端口：**
```bash
python stop_server.py --port 8001
```

#### 方法2：在终端中按 Ctrl+C

如果服务器是在终端前台运行的，直接按 `Ctrl+C` 即可停止。

#### 方法3：手动关闭进程

**Windows:**
```bash
# 1. 查找占用端口的进程ID
netstat -ano | findstr :8000

# 2. 关闭进程（替换PID为实际进程ID）
taskkill /PID [进程ID] /F
```

**Linux/Mac:**
```bash
# 1. 查找占用端口的进程ID
lsof -ti :8000

# 2. 关闭进程
kill -9 [进程ID]
```

## 使用Web界面

1. 启动服务器后，在浏览器中访问：`http://127.0.0.1:8000`
2. 上传图表图片（可选）
3. 上传CSV文件（可选）
4. 点击"开始分析"按钮
5. 等待分析完成，查看报告

## 使用API接口

### 健康检查
```bash
curl http://127.0.0.1:8000/health
```

### 分析数据
```bash
curl -X POST "http://127.0.0.1:8000/analyze" \
  -F "image=@chart.png" \
  -F "csv=@data.csv"
```

### Python示例
```python
import requests

files = {
    'image': open('chart.png', 'rb'),
    'csv': open('data.csv', 'rb')
}

response = requests.post('http://127.0.0.1:8000/analyze', files=files)
result = response.json()
print(result['report'])
```

## 测试功能

### 创建示例数据
```bash
python create_sample_data.py
```
这会创建：
- `sample_data.csv` - 示例CSV数据
- `sample_chart.png` - 示例图表

### 测试API
```bash
python test_api.py
```

## 常见问题

### Q: 端口被占用怎么办？
A: 使用 `stop_server.py` 或 `stop_server.bat` 关闭占用端口的进程，或修改 `.env` 文件中的 `API_PORT` 为其他端口。

### Q: 如何查看服务器是否在运行？
A: 访问 `http://127.0.0.1:8000/health` 或运行 `python test_api.py`

### Q: 服务器无法启动？
A: 
1. 检查端口是否被占用
2. 检查 `.env` 文件中的API密钥是否正确配置
3. 查看终端错误信息

### Q: 如何修改端口？
A: 在 `.env` 文件中修改 `API_PORT=8001`（或其他端口号）

